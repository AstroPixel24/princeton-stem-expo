<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration - Princeton STEM Expo (PSE)</title>
    <link rel="stylesheet" href="styles/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <h2>PSE</h2>
                </div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="index.html" class="nav-link">Home</a>
                    </li>
                    <li class="nav-item">
                        <a href="about.html" class="nav-link">About</a>
                    </li>
                    <li class="nav-item">
                        <a href="workshops.html" class="nav-link">Workshops</a>
                    </li>
                    <li class="nav-item">
                        <a href="schedule.html" class="nav-link">Schedule</a>
                    </li>
                    <li class="nav-item">
                        <a href="registration.html" class="nav-link active">Registration</a>
                    </li>
                    <li class="nav-item">
                        <a href="resources.html" class="nav-link">Resources</a>
                    </li>
                    <li class="nav-item">
                        <a href="sponsors.html" class="nav-link">Sponsors</a>
                    </li>
                    <li class="nav-item">
                        <a href="contact.html" class="nav-link">Contact</a>
                    </li>
                </ul>
                <div class="hamburger">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="page-header">
            <div class="container">
                <h1 class="page-title">Registration</h1>
                <p class="page-subtitle">Join the inaugural PSE 2025 - Individual mathematics competition registration</p>
                <div class="page-event-info">
                    <div class="page-event-details">
                        <div class="event-detail">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Saturday, September 27, 2025</span>
                        </div>
                        <div class="event-detail">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Hammarskjold Upper Elementary School</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="page-content">
            <div class="container">
                <!-- Registration Status -->
                <div class="content-section">
                    <div class="feature-card" style="text-align: center; background: linear-gradient(135deg, #10b981, #059669); color: white;">
                        <h2 style="color: white; margin-bottom: 1rem;">Inaugural Event - Registration is Now Open!</h2>
                        <p style="color: rgba(255,255,255,0.9); font-size: 1.1rem;">Be part of history! Secure your spot for the first-ever PSE on September 27, 2025 at Hammarskjold Upper Elementary School</p>
                        <div style="margin-top: 1.5rem;">
                            <strong style="font-size: 1.2rem;">Early Bird Pricing Available Until August 15, 2025</strong>
                        </div>
                    </div>
                </div>

                <!-- Registration Options -->
                <div class="content-section">
                    <h2>Individual Registration</h2>
                    <div class="feature-card" style="text-align: center; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; margin-bottom: 2rem;">
                        <h3 style="color: white; margin-bottom: 1rem;">‚ö†Ô∏è Limited Spots Available</h3>
                        <p style="color: rgba(255,255,255,0.9); font-size: 1.1rem;">Registration is first-come, first-served. Secure your spot today!</p>
                    </div>
                    
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <h3>Individual Student Registration (PLEASE FILL OUT REGISTRATION BELOW)</h3>
                            <p>Register as an individual student to compete in the Princeton STEM Expo mathematics competition.</p>
                            <ul style="text-align: left; margin: 1rem 0;">
                                <li>Participate in Sprint Round (30 problems)</li>
                                <li>Participate in Target Round (8 problems)</li>
                                <li>Compete in your grade division (Elementary or Middle School)</li>
                                <li>Have a chance to place well and win over <b>$1000+</b> worth in subscriptions and other prizes!</li>
                                <li>Participate in amazing Mini Events and learn new STEM concepts</li>
                                <li>Individual awards and recognition</li>
                            </ul>
                            <div class="pricing">
                                <div style="font-size: 1.5rem; font-weight: 700; color: #2563eb;">$25</div>
                            </div>
                            <div style="margin-top: 1.5rem;">
                                <script async
  src="https://js.stripe.com/v3/buy-button.js">
</script>

<stripe-buy-button
  buy-button-id="buy_btn_1S7FZ9L3WcAlke0tfywCniP2"
  publishable-key="pk_live_51RwmdKL3WcAlke0tvM5VmKJY6kgYxWQ0J0soqrWxy7JaEy98rZjzXrqHa14grLLgYMjwyOr9wUudCmUTvadOAZKv00tWp1mM55"
>
</stripe-buy-button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Registration Form -->
                <div class="content-section">
                    <h2>Registration Form</h2>
                    
                    <div class="form-container">
                        <!-- UPDATED FORM: Now properly submits to Google Apps Script -->
                        <form id="registrationForm" method = "POST" action="https://script.google.com/macros/s/AKfycbyW4RoGyn6Ccgd0jRBfKvWUflkxqKSoeH95tJfc0OqOmfQZm369UE4Wsn-gYzCF5sp4/exec">
                            <!-- Student Information -->
                            <h3>Student Information</h3>
                            <div class="form-group">
                                <label for="studentName">Student Full Name *</label>
                                <input type="text" id="studentName" name="Name" required>
                            </div>

                            <div class="form-group">
                                <label for="grade">Grade Level *</label>
                                <select id="grade" name="Grade" required>
                                    <option value="">Select grade</option>
                                    <option value="3">3rd Grade</option>
                                    <option value="4">4th Grade</option>
                                    <option value="5">5th Grade</option>
                                    <option value="6">6th Grade</option>
                                    <option value="7">7th Grade</option>
                                    <option value="8">8th Grade</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="school">School Name *</label>
                                <input type="text" id="school" name="School Name" required>
                            </div>

                            <div class="form-group">
                                <label for="studentEmail">Student Email</label>
                                <input type="email" id="studentEmail" name="Student Email">
                            </div>

                            <!-- Parent/Guardian Information -->
                            <h3>Parent/Guardian Information</h3>
                            <div class="form-group">
                                <label for="parentName">Parent/Guardian Name *</label>
                                <input type="text" id="parentName" name="Parent Name" required>
                            </div>

                            <div class="form-group">
                                <label for="parentEmail">Parent/Guardian Email *</label>
                                <input type="email" id="parentEmail" name="Parent Email" required>
                            </div>

                            <div class="form-group">
                                <label for="parentPhone">Parent/Guardian Phone *</label>
                                <input type="tel" id="parentPhone" name="Parent Phone" required>
                            </div>

                            <!-- Emergency Contact -->
                            <h3>Emergency Contact</h3>
                            <div class="form-group">
                                <label for="emergencyName">Emergency Contact Name *</label>
                                <input type="text" id="emergencyName" name="Emergency Contact Name" required>
                            </div>

                            <div class="form-group">
                                <label for="emergencyPhone">Emergency Contact Phone *</label>
                                <input type="tel" id="emergencyPhone" name="Emergency Contact Phone" required>
                            </div>

                            <div class="form-group">
                                <label for="emergencyRelation">Relationship to Student *</label>
                                <input type="text" id="emergencyRelation" name="Relationship to Student" required>
                            </div>

                            <!-- Additional Information -->
                            <h3>Additional Information</h3>
                            <div class="form-group">
                                <label for="dietary">Dietary Restrictions/Food Allergies</label>
                                <textarea id="dietary" name="Dietary Info" placeholder="Please list any dietary restrictions, food allergies, or special meal requirements"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="medical">Medical Conditions/Accommodations</label>
                                <textarea id="medical" name="Medical Conditions" placeholder="Please describe any medical conditions, learning accommodations, or special needs"></textarea>
                            </div>

                            <!-- Agreements & Permissions -->
                            <h3>Agreements & Permissions</h3>
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="liability" name="Liability Waiver" required>
                                    <label for="liability">I agree to the liability waiver and understand that participation is at my own risk. *</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="photography" name="Photography Permission">
                                    <label for="photography">I give permission for photographs taken during the event to be used for promotional purposes.</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="communication" name="Communication Permission">
                                    <label for="communication">I would like to receive updates about future PSE events and STEM opportunities.</label>
                                </div>
                            </div>

                            <!-- Payment Section -->
                            <h3>Payment Information</h3>
                            <div class="form-group">
                                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid #e2e8f0; margin-bottom: 1rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                        <span style="font-weight: 600; color: #1f2937;">Registration Fee:</span>
                                        <span style="font-size: 1.2rem; font-weight: 700; color: #2563eb;">$25.00</span>
                                    </div>
                                    <p style="color: #64748b; font-size: 0.9rem; margin: 0;">
                                        Secure payment processing by Stripe. All major credit cards accepted.
                                    </p>
                                </div>
                                
                                <!-- Stripe Payment Element Container -->
                                <div id="payment-element" style="margin-bottom: 1rem;">
                                    <!-- Stripe Payment Element will be mounted here -->
                                </div>
                                
                                <!-- Payment Error Display -->
                                <div id="payment-errors" role="alert" style="display: none; color: #dc2626; font-size: 0.9rem; margin-bottom: 1rem; padding: 0.75rem; background: #fef2f2; border: 1px solid #fecaca; border-radius: 4px;"></div>
                            </div>

                            <!-- Hidden field for amount -->
                            <input type="hidden" name="AmountCents" value="2500">
                            
                            <!-- Hidden field for PaymentIntent ID (added after successful payment) -->
                            <input type="hidden" id="paymentIntentId" name="PaymentIntentId" value="">

                            <!-- Submit Button -->
                            <div class="form-group">
                                <button type="submit" id="submitBtn" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem;" disabled>
                                    <span id="submit-text">Processing Payment Setup...</span>
                                    <span id="submit-spinner" style="display: none;">
                                        <i class="fas fa-spinner fa-spin" style="margin-right: 0.5rem;"></i>
                                        Processing...
                                    </span>
                                </button>
                            </div>

                            <p style="font-size: 0.9rem; color: #64748b; text-align: center; margin-top: 1rem;">
                                Your payment will be processed securely by Stripe. Registration will be completed only after successful payment.
                            </p>
                        </form>
                        
                        <!-- Success message -->
                        <div id="successMessage" style="display: none; text-align: center; margin-top: 2rem; padding: 1.5rem; background: #f0fdf4; border: 2px solid #22c55e; border-radius: 8px;">
                            <p style="color: #166534; font-size: 1.1rem; margin: 0;">
                                ‚úÖ Payment successful! Your registration has been completed and a confirmation email has been sent.
                            </p>
                        </div>

                        <!-- Error message -->
                        <div id="errorMessage" style="display: none; text-align: center; margin-top: 2rem; padding: 1.5rem; background: #fef2f2; border: 2px solid #ef4444; border-radius: 8px;">
                            <p style="color: #991b1b; font-size: 1.1rem; margin: 0;">
                                ‚ùå <span id="error-text">There was an error processing your registration. Please try again.</span>
                            </p>
                        </div>

                        <!-- Loading message -->
                        <div id="loadingMessage" style="display: block; text-align: center; margin-top: 2rem; padding: 1.5rem; background: #f0f9ff; border: 2px solid #3b82f6; border-radius: 8px;">
                            <p style="color: #1e40af; font-size: 1.1rem; margin: 0;">
                                <i class="fas fa-spinner fa-spin" style="margin-right: 0.5rem;"></i>
                                Setting up secure payment system...
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Important Dates & Information -->
                <div class="content-section">
                    <h2>Important Dates & Deadlines</h2>
                    <div class="resource-grid">
                        <div class="resource-card">
                            <h3><i class="fas fa-calendar-alt"></i> Registration Opens</h3>
                            <p><strong>July 15, 2025</strong></p>
                            <p>Online registration begins for all participants</p>
                        </div>
                        
                        <div class="resource-card">
                            <h3><i class="fas fa-tag"></i> Early Bird Deadline</h3>
                            <p><strong>August 15, 2025</strong></p>
                            <p>Register by this date for discounted pricing</p>
                        </div>
                        
                        <div class="resource-card">
                            <h3><i class="fas fa-clock"></i> Regular Registration</h3>
                            <p><strong>August 16 - September 20, 2025</strong></p>
                            <p>Standard pricing applies after early bird deadline</p>
                        </div>
                        
                        <div class="resource-card">
                            <h3><i class="fas fa-exclamation-triangle"></i> Registration Closes</h3>
                            <p><strong>September 20, 2025</strong></p>
                            <p>Final deadline - no late registrations accepted</p>
                        </div>
                    </div>
                </div>

                <!-- Eligibility & Requirements -->
                <div class="content-section">
                    <h2>Eligibility & Requirements</h2>
                    
                    <h3>Who Can Participate</h3>
                    <ul>
                        <li>Current elementary school students (grades 3-5)</li>
                        <li>Current middle school students (grades 6-8)</li>
                        <li>Students must be enrolled in school for the 2024-2025 academic year</li>
                        <li>Homeschooled students are welcome</li>
                    </ul>

                    <h3>Required Documentation</h3>
                    <ul>
                        <li>Completed registration form with parent/guardian signature</li>
                        <li>Proof of grade level (report card or school verification)</li>
                        <li>Photo ID on day of event</li>
                        <li>Completed liability waiver</li>
                    </ul>

                    <h3>Competition Format</h3>
                    <ul>
                        <li>Individual competition only - no team rounds</li>
                        <li>Students compete in their appropriate grade division</li>
                        <li>Elementary Division: Grades 3-5</li>
                        <li>Middle School Division: Grades 6-8</li>
                    </ul>
                </div>

                <!-- Payment Information -->
                <div class="content-section">
                    <h2>Payment Information</h2>
                    
                    <h3>Payment Methods</h3>
                    <ul>
                        <li><strong>Online Payment:</strong> Credit card or PayPal (preferred method)</li>
                        <li><strong>Check:</strong> Made payable to "Princeton STEM Expo"</li>
                    </ul>

                    <h3>Pricing</h3>
                    <ul>
                        <li><strong>Early Bird (until August 15, 2025):</strong> $15 per student</li>
                        <li><strong>Regular Registration:</strong> $20 per student</li>
                    </ul>

                    <h3>Refund Policy</h3>
                    <ul>
                        <li><strong>Full Refund:</strong> Cancellations before September 1, 2025</li>
                        <li><strong>50% Refund:</strong> Cancellations September 2 - September 15, 2025</li>
                        <li><strong>No Refund:</strong> Cancellations after September 15, 2025</li>
                        <li><strong>Emergency Situations:</strong> Refunds considered on case-by-case basis</li>
                    </ul>

                    <h3>Financial Assistance</h3>
                    <p>Limited scholarships are available for students with demonstrated financial need. Contact us at <a href="mailto:princetonstemexpo@gmail.com">princetonstemexpo@gmail.com</a> for more information.</p>
                </div>

                <!-- Contact Information -->
                <div class="content-section">
                    <h2>Registration Questions?</h2>
                    <p>If you have questions about registration, please don't hesitate to contact us:</p>
                    
                    <div class="feature-card" style="background: #f8fafc;">
                        <h3>Registration Support</h3>
                        <p><strong>Email:</strong> <a href="mailto:princetonstemexpo@gmail.com">princetonstemexpo@gmail.com</a></p>
                        <p>We typically respond to emails within 24 hours during business days.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Princeton STEM Expo</h3>
                    <p>Empowering the next generation of STEM leaders through mathematics and innovation.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="about.html">About</a></li>
                        <li><a href="schedule.html">Schedule</a></li>
                        <li><a href="registration.html">Registration</a></li>
                        <li><a href="resources.html">Resources</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <p>Email: princetonstemexpo@gmail.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Princeton STEM Expo. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/script.js"></script>
    
    <!-- Stripe JavaScript -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <script>
        // Embedded Stripe Payment Element Implementation
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('registrationForm');
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submit-text');
            const submitSpinner = document.getElementById('submit-spinner');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('error-text');
            const loadingMessage = document.getElementById('loadingMessage');
            const paymentErrors = document.getElementById('payment-errors');
            
            // Initialize Stripe
            const stripe = Stripe('pk_live_51RwmdKL3WcAlke0tvM5VmKJY6kgYxWQ0J0soqrWxy7JaEy98rZjzXrqHa14grLLgYMjwyOr9wUudCmUTvadOAZKv00tWp1mM55');
            
            // Your Google Apps Script URL - replace with your actual URL
            const scriptURL = 'https://script.google.com/macros/s/AKfycbyW4RoGyn6Ccgd0jRBfKvWUflkxqKSoeH95tJfc0OqOmfQZm369UE4Wsn-gYzCF5sp4/exec';
            
            let elements;
            let paymentElement;
            let clientSecret;
            let paymentIntentId;

            // Initialize payment system
            async function initializePayment() {
                try {
                    console.log('üîÑ Initializing payment system...');
                    
                    // Get amount from hidden field or use default
                    const amountInput = document.querySelector('input[name="AmountCents"]');
                    const amount = amountInput ? amountInput.value : '2500'; // $25.00

                    // Create PaymentIntent via Google Apps Script
                    const response = await fetch(scriptURL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: new URLSearchParams({
                            action: 'createPaymentIntent',
                            amount: amount,
                            currency: 'usd'
                        })
                    });

                    const result = await response.json();
                    
                    if (result.error) {
                        throw new Error(result.error);
                    }

                    clientSecret = result.clientSecret;
                    paymentIntentId = result.paymentIntentId;
                    
                    console.log('‚úÖ PaymentIntent created:', paymentIntentId);

                    // Create Stripe Elements
                    const appearance = {
                        theme: 'stripe',
                        variables: {
                            colorPrimary: '#2563eb',
                            colorBackground: '#ffffff',
                            colorText: '#1f2937',
                            colorDanger: '#dc2626',
                            fontFamily: 'Inter, system-ui, sans-serif',
                            spacingUnit: '4px',
                            borderRadius: '6px'
                        }
                    };

                    elements = stripe.elements({ appearance, clientSecret });
                    
                    // Create Payment Element
                    paymentElement = elements.create('payment');
                    paymentElement.mount('#payment-element');

                    // Handle payment element changes
                    paymentElement.on('change', (event) => {
                        if (event.error) {
                            showPaymentError(event.error.message);
                        } else {
                            hidePaymentError();
                        }
                        
                        // Enable submit button if ready
                        if (event.complete) {
                            submitBtn.disabled = false;
                            submitText.textContent = 'Complete Registration & Payment';
                        }
                    });

                    // Hide loading, enable form
                    loadingMessage.style.display = 'none';
                    submitBtn.disabled = false;
                    submitText.textContent = 'Complete Registration & Payment';
                    
                    console.log('‚úÖ Payment Element mounted successfully');
                    
                } catch (error) {
                    console.error('‚ùå Payment initialization error:', error);
                    loadingMessage.style.display = 'none';
                    showError('Failed to initialize payment system: ' + error.message);
                }
            }

            // Form submission handler
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                console.log('=== FORM SUBMISSION STARTED ===');
                
                // Validate required fields
                const requiredFields = form.querySelectorAll('[required]');
                let isValid = true;
                
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        isValid = false;
                        field.style.borderColor = '#ef4444';
                        field.style.boxShadow = '0 0 0 1px #ef4444';
                    } else {
                        field.style.borderColor = '#e2e8f0';
                        field.style.boxShadow = 'none';
                    }
                });

                if (!isValid) {
                    showError('Please fill in all required fields marked with *');
                    return;
                }

                // Show loading state
                setSubmitLoading(true);
                hideMessages();

                try {
                    console.log('üîÑ Confirming payment...');
                    
                    // Confirm payment with Stripe
                    const { error, paymentIntent } = await stripe.confirmPayment({
                        elements,
                        redirect: 'if_required'
                    });

                    if (error) {
                        console.error('‚ùå Payment confirmation error:', error);
                        if (error.type === 'card_error' || error.type === 'validation_error') {
                            showPaymentError(error.message);
                        } else {
                            showError('Payment failed: ' + error.message);
                        }
                        return;
                    }

                    if (paymentIntent.status === 'succeeded') {
                        console.log('‚úÖ Payment successful!', paymentIntent.id);
                        
                        // Add PaymentIntent ID to form
                        document.getElementById('paymentIntentId').value = paymentIntent.id;
                        
                        // Submit form to Google Sheets
                        await submitFormToSheets();
                        
                    } else {
                        console.log('‚ö†Ô∏è Payment requires additional action');
                        showError('Payment requires additional verification. Please try again.');
                    }
                    
                } catch (error) {
                    console.error('‚ùå Submission error:', error);
                    showError('An unexpected error occurred. Please try again.');
                } finally {
                    setSubmitLoading(false);
                }
            });

            // Submit form data to Google Sheets
            async function submitFormToSheets() {
                try {
                    console.log('üîÑ Submitting to Google Sheets...');
                    
                    const formData = new FormData(form);
                    
                    // Handle checkboxes properly
                    formData.set('Liability Waiver', document.getElementById('liability').checked ? 'Yes' : 'No');
                    formData.set('Photography Permission', document.getElementById('photography').checked ? 'Yes' : 'No');
                    formData.set('Communication Permission', document.getElementById('communication').checked ? 'Yes' : 'No');
                    
                    // Debug: Log form data
                    console.log('Form data being sent:');
                    for (let [key, value] of formData.entries()) {
                        console.log(key + ': ' + value);
                    }

                    const response = await fetch(scriptURL, {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.text();
                    console.log('Google Sheets response:', result);
                    
                    try {
                        const jsonResult = JSON.parse(result);
                        if (jsonResult.ok || jsonResult.result === 'success') {
                            console.log('‚úÖ Successfully saved to Google Sheets!');
                            showSuccess();
                            form.reset();
                        } else {
                            throw new Error(jsonResult.error || 'Unknown error from Google Sheets');
                        }
                    } catch (parseError) {
                        // If response isn't JSON, check if it contains success indicators
                        if (result.toLowerCase().includes('success') || result.toLowerCase().includes('ok')) {
                            console.log('‚úÖ Successfully saved to Google Sheets (non-JSON response)');
                            showSuccess();
                            form.reset();
                        } else {
                            throw new Error('Unexpected response from Google Sheets: ' + result);
                        }
                    }
                    
                } catch (error) {
                    console.error('‚ùå Google Sheets submission error:', error);
                    showError('Registration was processed but there was an error saving your information. Please contact support with your payment confirmation.');
                }
            }

            // Utility functions
            function setSubmitLoading(loading) {
                submitBtn.disabled = loading;
                if (loading) {
                    submitText.style.display = 'none';
                    submitSpinner.style.display = 'inline';
                } else {
                    submitText.style.display = 'inline';
                    submitSpinner.style.display = 'none';
                }
            }

            function showPaymentError(message) {
                paymentErrors.textContent = message;
                paymentErrors.style.display = 'block';
            }

            function hidePaymentError() {
                paymentErrors.style.display = 'none';
            }

            function showError(message) {
                errorText.textContent = message;
                errorMessage.style.display = 'block';
                errorMessage.scrollIntoView({ behavior: 'smooth' });
            }

            function showSuccess() {
                successMessage.style.display = 'block';
                successMessage.scrollIntoView({ behavior: 'smooth' });
            }

            function hideMessages() {
                successMessage.style.display = 'none';
                errorMessage.style.display = 'none';
                hidePaymentError();
            }

            // Initialize payment system when page loads
            initializePayment();
        });
    </script>
</body>
</html>
